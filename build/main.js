/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";document.querySelector(".grid-cards__container");const e=document.querySelector(".profile__edit-button"),t=document.querySelector(".profile__add-button"),r=(document.querySelector(".profile__name"),document.querySelector(".profile__job"),document.querySelector(".popup_edit-profile")),o=document.forms["profile-form"],s=r.querySelector(".popup__input_type_name"),n=r.querySelector(".popup__input_type_job"),i=document.querySelector(".popup_add-card"),p=document.forms["card-form"],a=(i.querySelector(".popup__input_type_card-name"),i.querySelector(".popup__input_type_card-url"),document.querySelector(".popup_open-card")),c=a.querySelector(".popup__img"),l=a.querySelector(".popup__caption"),u=document.querySelector(".template-card").content,d=(document.querySelectorAll(".popup"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",inputErrorActiveClass:"popup__input-error_active",errorClass:"popup__error_visible"});class _{constructor(e,t,r){this._data=e,this._name=e.name,this._link=e.link,this._template=t,this._handleCardPreview=r}_cloneCardTemplate(){return this._template.querySelector(".grid-card").cloneNode(!0)}_setEventListeners(e,t){const r=e.querySelector(".grid-card__delete"),o=e.querySelector(".grid-card__like");r.addEventListener("click",(()=>e.remove())),o.addEventListener("click",this._toggleLikeButton),t.addEventListener("click",(()=>this._handleCardPreview(this._data)))}createCard(){const e=this._cloneCardTemplate(),t=e.querySelector(".grid-card__img");return e.querySelector(".grid-card__name").textContent=this._name,t.src=this._link,t.alt=this._name,this._setEventListeners(e,t),e}_toggleLikeButton(e){e.target.classList.toggle("grid-card__like_active")}}class m{constructor(e,t){this._formElement=e,this._config=t,this._inputList=Array.from(e.querySelectorAll(t.inputSelector)),this._buttonElement=e.querySelector(t.submitButtonSelector)}_setEventListeners(e,t){this._toggleButtonState(t),e.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleButtonState(t)}),0)})),this._inputList.forEach((r=>{r.addEventListener("input",(()=>{this._toggleButtonState(t),this._checkInputValidity(e,r,t)}))}))}_checkInputValidity(e,t,r){t.validity.valid?this._hideInputError(e,t,r):this._showInputError(e,t,t.validationMessage,r)}_toggleButtonState(e){this._buttonElement.closest(".popup__form").checkValidity()?(this._buttonElement.classList.remove(e.inactiveButtonClass),this._buttonElement.removeAttribute("disabled")):(this._buttonElement.classList.add(e.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0))}_showInputError(e,t,r,o){const s=e.querySelector(`.${t.id}-error`);s.classList.add(o.inputErrorActiveClass),s.textContent=r,t.classList.add(o.inputErrorClass)}_hideInputError(e,t,r){const o=e.querySelector(`.${t.id}-error`);o.textContent="",o.classList.remove(r.inputErrorActiveClass),t.classList.remove(r.inputErrorClass)}enableValidation(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners(this._formElement,this._config)}removeValidationErrors(e){e.querySelectorAll(".popup__input").forEach((t=>{const r=e.querySelector(`.${t.id}-error`);r.textContent="",r.classList.remove(this._config.inputErrorActiveClass),t.classList.remove(this._config.inputErrorClass)})),e.reset()}}const h=class{constructor(e){this._popupSelector=e,this._handleEscClose=this._handleEscClose.bind(this),this.closePopup=this.closePopup.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.closePopup()}openPopup(){document.addEventListener("keydown",this._handleEscClose),this._popupSelector.classList.add("popup_opened")}closePopup(){document.removeEventListener("keydown",this._handleEscClose),this._popupSelector.classList.remove("popup_opened")}setEventListeners(){this._popupSelector.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-btn"))&&this.closePopup()}))}},v=class extends h{constructor(e,t){super(e),this._popupSelector=e,this._submitForm=this._popupSelector.querySelector(".popup__form"),this._submitCallback=t.bind(this),this._inputArray=Array.from(this._submitForm.querySelectorAll(".popup__input"))}_getInputValues(){return this._dataFromInput={},this._inputArray.forEach((e=>{this._dataFromInput[e.name]=e.value})),console.log(this._dataFromInput),this._dataFromInput}setEventListeners(){super.setEventListeners(),this._submitForm.addEventListener("submit",(()=>{this._submitCallback(this._getInputValues())}),{once:!0})}closePopup(){this._submitForm.reset(),super.closePopup()}},y=class extends h{constructor(e,t,r,o){super(e),this._popupPreviewImg=t,this._popupPreviewCaption=r,this._data=o}openPopup(){this._popupPreviewImg.src=this._data.link,this._popupPreviewImg.alt=this._data.name,this._popupPreviewCaption.textContent=this._data.name,super.openPopup()}closePopup(){super.closePopup(),this._popupPreviewImg.src="#"}},f=new class{constructor({nameInputSelector:e,professionInputSelector:t}){this._name=document.querySelector(e),this._profession=document.querySelector(t)}getUserInfo(){return{name:this._name.textContent,profession:this._profession.textContent}}setUserInfo({name:e,profession:t}){this._name.textContent=e,this._profession.textContent=t}}({nameInputSelector:".profile__name",professionInputSelector:".profile__job"}),E=e=>{const t=new y(a,c,l,e);t.setEventListeners(),t.openPopup()},S=new class{constructor({data:e,renderer:t},r){this._initialArray=e,this._renderer=t,this._selector=r,this._container=document.querySelector("."+r)}renderInitialItems(){this._initialArray.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({data:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:g},"grid-cards__container");function g(e){const t=new _(e,u,E).createCard();S.addItem(t)}S.renderInitialItems();const b=Array.from(document.querySelectorAll(d.formSelector)),L={};b.forEach((e=>{const t=new m(e,d);L[e.name]=t,t.enableValidation()})),e.addEventListener("click",(function(){const e=new v(r,(({nickname:t,job:r})=>{f.setUserInfo({name:t,profession:r}),e.closePopup()}));e.setEventListeners(),e.openPopup(),L["profile-form"].removeValidationErrors(o),s.value=f.getUserInfo().name,n.value=f.getUserInfo().profession})),t.addEventListener("click",(()=>{!function(e){const t=new v(e,(({description:e,url:r})=>{g({name:e,link:r}),t.closePopup()}));t.setEventListeners(),t.openPopup(e),L["card-form"].removeValidationErrors(p)}(i)}))})();